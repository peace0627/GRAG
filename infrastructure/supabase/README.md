# Supabase Vector Database Setup

æ­¤ç›®éŒ„åŒ…å« Supabase pgvector è¨­ç½®è…³æœ¬ï¼Œç”¨æ–¼ GraphRAG ç³»çµ±çš„å‘é‡å­˜å„²ã€‚

## æª”æ¡ˆèªªæ˜

### ğŸ“‹ æ–‡ä»¶èªªæ˜

#### supabase-setup.sql (èˆŠç‰ˆ)
**ç‹€æ…‹**: âš ï¸ **å·²éæ™‚** - ä½¿ç”¨vector(384)æ ¼å¼
å‘é‡è¡¨åˆå§‹åŒ–è…³æœ¬çš„èˆŠç‰ˆæœ¬ã€‚

#### rebuild_supabase_table.sql (æœ€æ–°) â­
**ç‹€æ…‹**: âœ… **ç•¶å‰æ¨è–¦** - ä½¿ç”¨JSONBæ ¼å¼
æœ€æ–°çš„å‘é‡è¡¨åˆå§‹åŒ–è…³æœ¬ï¼Œè§£æ±ºäº†å‘é‡å­˜å„²çš„åºåˆ—åŒ–å•é¡Œï¼š
- è¡¨çµæ§‹å‰µå»º (ä½¿ç”¨JSONBå­˜å„²å‘é‡)
- ç´¢å¼•è¨­ç½®
- RLSæ¬Šé™è¨­ç½®

#### supabase-rls-fix.sql
å°ˆé–€ç”¨æ–¼ä¿®å¾©å‘é‡è¡¨æ¬Šé™å•é¡Œçš„è…³æœ¬ã€‚

#### vector_table_maintenance.py
Pythonç¶­è­·è…³æœ¬ï¼Œç”¨æ–¼æ¸…ç†å’Œé‡å»ºå‘é‡è¡¨ï¼š
- é€£æ¥Supabaseæ•¸æ“šåº«
- åˆªé™¤èˆŠçš„éŒ¯èª¤è¨˜éŒ„
- æº–å‚™æ–°è¡¨çµæ§‹

## âš ï¸ é‡è¦æ³¨æ„äº‹é …ï¼šå‘é‡ç¶­åº¦è¨­å®š

### ç•¶å‰å‘é‡ç¶­åº¦ç‚º 384
åœ¨ `supabase-setup.sql` ä¸­ï¼Œå‘é‡è¡¨çš„ `embedding` æ¬„ä½å®šç¾©ç‚ºï¼š
```sql
embedding vector(384)
```

### èˆ‡ç’°å¢ƒè®Šæ•¸çš„é—œä¿‚
`.env` æª”æ¡ˆä¸­çš„ `EMBEDDING_DIMENSION=384` **ä¸æœƒè‡ªå‹•æ›´æ–°** å‘é‡è¡¨çš„çµæ§‹ï¼

- **SQL è…³æœ¬**: éœæ…‹å®šç¾©è¡¨çµæ§‹ï¼ŒåŒ…æ‹¬å‘é‡ç¶­åº¦
- **ç’°å¢ƒè®Šæ•¸**: ç”¨æ–¼ä»£ç¢¼é‚è¼¯å’Œå¾Œå‚™å€¼é©—è­‰ï¼Œä¸æ˜¯å‹•æ…‹è¡¨çµæ§‹

### ä½•æ™‚éœ€è¦ä¿®æ”¹å‘é‡ç¶­åº¦ï¼Ÿ

ç•¶æ‚¨éœ€è¦å®Œå…¨æ›¿æ›åµŒå…¥æ¨¡å‹æ™‚ï¼š
1. **ä¿®æ”¹ SQL è…³æœ¬**: ç·¨è¼¯ `supabase-setup.sql` ä¸­çš„ `vector(æ–°ç¶­åº¦)`
2. **é‡å»ºè¡¨**: åœ¨ Supabase ä¸­åŸ·è¡Œé‡å»ºè…³æœ¬ï¼ˆæœƒåˆªé™¤ç¾æœ‰è³‡æ–™ï¼‰
3. **æ›´æ–° .env**: ä¿®æ”¹ `EMBEDDING_DIMENSION` ç‚ºæ–°ç¶­åº¦å€¼
4. **é‡æ–°ç´¢å¼•**: é‡æ–°åŸ·è¡Œæ–‡æª”è™•ç†ä»¥ç”Ÿæˆæ–°çš„å‘é‡

### å¸¸è¦‹å‘é‡ç¶­åº¦å°æ‡‰
```plaintext
- Sentence Transformers (all-MiniLM-L6-v2): 384
- OpenAI (text-embedding-ada-002): 1536
- Cohere: 1024
```

## ğŸš€ ä½¿ç”¨æ­¥é©Ÿ (æœ€æ–°ç‰ˆæœ¬)

### 1. åˆå§‹è¨­ç½® (æ¨è–¦)
```bash
# åœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œæœ€æ–°è…³æœ¬
# åŸ·è¡Œ: infrastructure/supabase/rebuild_supabase_table.sql
```

### 2. æ¬Šé™ä¿®å¾© (å¦‚éœ€è¦)
```bash
# å¦‚é‡æ¬Šé™éŒ¯èª¤ï¼ŒåŸ·è¡Œä¿®å¾©è…³æœ¬
# åŸ·è¡Œ: infrastructure/supabase/supabase-rls-fix.sql
```

### 3. æ•¸æ“šæ¸…ç† (å¦‚éœ€è¦)
```bash
# ä½¿ç”¨Pythonè…³æœ¬æ¸…ç†èˆŠæ•¸æ“š
cd infrastructure/supabase
python vector_table_maintenance.py
```

### 4. é©—è­‰è¨­ç½®
åœ¨ Supabase SQL Editor ä¸­ç¢ºèªï¼š
```sql
SELECT * FROM public.vectors LIMIT 1;
```

### âš ï¸ ç‰ˆæœ¬èªªæ˜
- **æ–°é …ç›®**: ä½¿ç”¨ `rebuild_supabase_table.sql` (JSONBæ ¼å¼)
- **èˆŠé …ç›®å‡ç´š**: å…ˆåŸ·è¡Œ `vector_table_maintenance.py` æ¸…ç†èˆŠæ•¸æ“šï¼Œç„¶å¾Œé‡å»ºè¡¨

## æ’æŸ¥å•é¡Œ

- **èªæ³•éŒ¯èª¤**: ç¢ºä¿ä½¿ç”¨ PostgreSQL èªæ³•ï¼ˆé MySQLï¼‰
- **æ¬Šé™å•é¡Œ**: åœ¨é–‹ç™¼ç’°å¢ƒä½¿ç”¨ `supabase-rls-fix.sql` è¨­å®šå¯¬é¬†æ¬Šé™
- **å‘é‡ç¶­åº¦å•é¡Œ**: ä½¿ç”¨èˆ‡åµŒå…¥æ¨¡å‹åŒ¹é…çš„ç¶­åº¦

---

### ğŸ’¡ é–‹ç™¼å»ºè­°
å»ºè­°ä¿ç•™ä¸€å€‹ `supabase-setup-dynamic.sql` è…³æœ¬æ¨¡æ¿ï¼Œæ–¹ä¾¿å‹•æ…‹ç”Ÿæˆä¸åŒç¶­åº¦çš„è¡¨å®šç¾©ã€‚
